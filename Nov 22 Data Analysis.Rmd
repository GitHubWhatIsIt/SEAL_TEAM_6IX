 ---
title: "Nov 22 Data Analysis"
author: "Richard"
date: "November 22, 2018"
output: html_document
---

# Load Data


```{r}
library(tidyverse)

swallows <- read_csv("Swallows Data Expanded.csv")

swallows <- swallows[,c(139, 1:138, 140:150)]

# Out of 9703 rows, 9608 have SpeciesTotal <= 100, so adjust >100 to 100 for better heatmap
swallows1 <- swallows %>% 
  mutate(SpeciesTotal1 = ifelse(SpeciesTotal > 100, 100, SpeciesTotal))

swallows1 <- swallows1[, c(1, 151, 2:150)]
head(swallows1)

write_csv(swallows1, "temp.csv")
```

# Make heatmap -- distribution to year

## Prepare to draw map of Ontario

```{r}
# install.packages("rworldmap")
library(rworldmap)
area_map <- getMap(resolution = "low")
plot(area_map, xlim = c(-141,-53), ylim = c(40,85), asp = 1)

# install.packages("ggmap")
# library(ggmap)
# map <- get_map(location = c(lon = -84, lat = 47), zoom = 12)
# 
# ggmap(map)
   
install.packages("maps")
install.packages("mapdata")
library(maps)
library(mapdata)

ontario_map1 <- map("world",
    xlim = c(-100, -70),
    ylim = c(40, 60),
    fill = FALSE) %>% 
  head()

ggplot() + 
  geom_polygon(data = world_map1, aes(x = long, y = lat, group = group),
               xlim = c(-141,-53), ylim = c(40,85),
               fill = NA, color = "black") + 
  coord_fixed(1.3) 

```


## Swallows Distribution by years

Note: More routes have been observed between 2014-2015 (i.e. >=75).

(Which one?)
(Probably not this)
```{r}

# mutate(StartT = ifelse(TempScale == "F", (StartTemp - 32) / 1.8, StartTemp)) %>%

swallows_1994 <- swallows %>%
  filter(Year == 2011, species == "Tree Swallow")

ggplot(swallows_1994, aes(x = Longitude, y = Latitude)) +
  geom_point(aes(color = SpeciesTotal)) +
  facet_wrap(~species) +
  theme_light() +
  theme(axis.text.x = element_text(size = 9, angle = 45, hjust = 1)) +
  scale_color_gradientn(limits = c(0,600),
                       # low = "yellow", high = "red",
                       colours = rainbow(5),
                       name = "Birds Observed at Route")
  
```

Use this one

```{r}

# mutate(StartT = ifelse(TempScale == "F", (StartTemp - 32) / 1.8, StartTemp)) %>%

Swallows_temp <- swallows1 %>%
  filter(Year == 1994, species == "Tree Swallow")

# plot(newmap, xlim = c(-100, -70), ylim = c(40, 60), asp = 1) +
  
# plot(newmap, xlim = c(-100, -70), ylim = c(40, 60), asp = 1)
ggplot() +
  # geom_polygon(newmap) +
  geom_point(data = Swallows_temp, aes(x = Longitude, y = Latitude,
                                size = SpeciesTotal1
                 # , color = SpeciesTotal1
                 )) +
  # facet_wrap(~species) +
  theme_classic() +
  ggtitle("Tree Swallow Distribution: 1994") +
  theme(axis.text.x = element_text(size = 9, angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5)) +
  # scale_color_gradient(limits = c(0,100),
  #                      low = "blue", high = "red",
  #                      # colours = rainbow(5),
  #                      name = "Birds Observed at Route") +
  scale_size_continuous(limits = c(0, 100), # Range of number observed
                        range = c(1, 4), # Range of size of dots
                        name = "Birds Observed at Route")+
  xlim(-95, -74) + ylim(42, 53)
```

# IDEA to self: gganimate by years
# IDEA: check geom_grid